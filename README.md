# FAQC-light-TS

**Fast-Acting Quality Context — TypeScript lightweight edition**  
*(速効品質コンテキスト TS軽量版)*

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

---

## 概要

FAQC-light-TS は、AI エージェント（LLM）と協働して**品質駆動開発**を実現する TypeScript プロジェクトフレームワークです。設計から実装まで一貫した品質基準を維持し、コード生成前に品質コンテキストを把握することで、手戻りコストを最小化します。

### 主要な特徴

- **品質ゲートの自動実行**: ESLint、TypeScript型検査、ポリシー検証、テストを AI が自動実行
- **品質コンテキストの可視化**: AI が品質ルールを理解し、詳細レポートを自動生成
- **厳格なポリシー検証**: Anti-MVP、型安全性、ドキュメント規約などを事前チェック
- **SPEC-and-DESIGN 駆動**: 仕様を明文化してから実装に移行する明確なフロー
- **プロンプトベース開発**: 自然言語の指示で品質を保ちながら開発を進行

---

## このREADMEの使い方

このドキュメントは、**あなた（ユーザー）が AI エージェント（LLM）にどのような指示を出せば良いか**を説明するガイドです。各セクションには「プロンプト例」が記載されており、そのままコピー&ペーストして使用できます。

---

## クイックスタート

### 初回セットアップ

**プロンプト例:**
```
このプロジェクトの初回セットアップを実行してください。
依存関係のインストールと品質コンテキストの初期化を行ってください。
```

AI は以下を実行します:
- `npm install` で依存関係をインストール
- `npm run check:pre-common` で品質コンテキストを生成
- 品質ゲートの初回実行で環境を確認

---

## プロジェクト構造

```
FAQC-light-TS/
├── qualities/                  # 品質ゲート設定（単一情報源）
│   ├── check-steps.ts         # ゲート実行順序の定義
│   ├── eslint/                # ESLint設定（5つのユニット）
│   │   ├── 01-module-boundaries/     # モジュール境界検証
│   │   ├── 02-type-safety/           # 型安全性検証
│   │   ├── 03-documentation/         # ドキュメント規約
│   │   ├── 04-complexity-and-magic/  # 複雑度とマジックナンバー
│   │   ├── 05-environment-exceptions/ # 環境変数例外検証
│   │   └── plugins/                  # カスタムESLintプラグイン
│   ├── tsconfig/              # TypeScript厳密設定
│   └── policy/                # カスタムポリシー検証
│       ├── anti_mvp/          # 互換残骸・沈黙フォールバック禁止
│       ├── jsdoc_no_duplicate/ # JSDoc重複禁止
│       ├── no_relaxation/     # 型緩和禁止
│       └── no_unknown_double_cast/ # 不明なダブルキャスト禁止
│
├── vibecoding/                # 開発フレームワーク
│   ├── docs/PLAYBOOK/         # プレイブック（AI が参照）
│   │   ├── PRE-COMMON.md      # 品質コンテキスト更新手順
│   │   ├── PRE-SnD.md         # SPEC-and-DESIGN作成前手順
│   │   └── PRE-IMPL.md        # 実装開始前手順
│   ├── scripts/qualities/     # 品質管理スクリプト
│   └── var/
│       ├── contexts/qualities/  # 品質コンテキスト詳細レポート（AI生成）
│       └── SPEC-and-DESIGN/     # 仕様設計ドキュメント
│
├── scripts/qualities/         # 実行スクリプト
│   └── check.ts               # 統一品質ゲート実行ポイント
│
└── tests/                     # テスト
    └── quality/               # 品質検証テスト
```

---

## 基本的な開発フロー

### 1. 新機能の開発を始める

**プロンプト例:**
```
新しい機能「[機能名]」を開発したいです。
この機能は[簡単な説明]を行うものです。
SPEC-and-DESIGN を作成してください。
```

AI の動作:
1. `PRE-COMMON` を実行して品質コンテキストを最新化
2. `vibecoding/docs/PLAYBOOK/_SnD-template.md` をベースに SnD を作成
3. 背景、目的、非目標、設計構想、品質ゲート、受入条件などを記述
4. 不明点があれば「未確定事項」として明示し、あなたに質問

### 2. 仕様を確定する

**プロンプト例:**
```
SnD の未確定事項について、[あなたの回答や補足情報]。
SnD を更新して Ready 状態にしてください。
```

AI の動作:
1. 未確定事項を解消し、SnD を更新
2. `quality_refresh_hash_at_created` を記録
3. SnD の `status` を `Ready` に変更
4. 実装フェーズへの移行準備が完了

### 3. 実装を開始する

**プロンプト例:**
```
PHASE=IMPL 承認: SnD=vibecoding/var/SPEC-and-DESIGN/SnD-[日付]-[名前].md
```

または、より自然な表現:
```
[機能名] の実装を開始してください。
SnD に基づいてコードを生成してください。
```

AI の動作:
1. `PRE-IMPL` を実行して実装前の品質ゲートを確認
2. `quality_refresh_hash_before_impl` を記録
3. SnD の内容に基づいてコードとテストを生成
4. 生成後、品質ゲートを自動実行
5. エラーがあれば自動修正（最大3回まで）

### 4. 既存コードの修正

**プロンプト例:**
```
[ファイル名] の [機能/関数] を修正してください。
[修正内容の説明]
```

AI の動作:
1. 既存の SnD があれば参照、なければ小規模修正として処理
2. 修正範囲が小さい場合（`MAINT=承認` の範囲内）はそのまま実行
3. 修正範囲が大きい場合は SnD の作成を提案

---

## 品質管理のプロンプト

### 品質ゲートを実行する

**プロンプト例:**
```
品質ゲートを実行してください。
```

または
```
コードの品質チェックを実行してください。
```

AI の動作:
- ポリシー検証、型検査、Lint、テストを順次実行
- エラーがあれば詳細を報告し、修正方法を提案

### 品質コンテキストを更新する

**プロンプト例:**
```
品質コンテキストを更新してください。
```

または
```
PRE-COMMON を実行してください。
```

AI の動作:
1. `npm run check:pre-common` を実行
2. 不足している品質コンテキストがあれば自動生成
3. `vibecoding/var/contexts/qualities/**/context.md` を更新（60-100行の詳細レポート）
4. 各ユニットの Why/Where/What/How を明確化

### 特定の品質ゲートのみを実行する

**プロンプト例:**
```
型検査だけを実行してください。
```

または
```
ESLint だけを実行してください。
```

または
```
Anti-MVP ポリシーだけを確認してください。
```

---

## よくある開発シナリオ

### シナリオ 1: 新しいユーティリティ関数を追加したい

**プロンプト例:**
```
src/utils/ に [関数名] という新しいユーティリティ関数を追加したいです。
この関数は [説明] を行います。
SnD を作成して実装してください。
```

### シナリオ 2: バグを修正したい

**プロンプト例:**
```
[ファイル名] の [関数名] にバグがあります。
[バグの説明]
修正してください。
```

小規模な修正の場合、AI は SnD を作成せずに直接修正することがあります。

### シナリオ 3: コードレビューをしてほしい

**プロンプト例:**
```
[ファイル名] のコードをレビューしてください。
品質ゲートの観点で改善点を教えてください。
```

AI の動作:
- 品質コンテキストに基づいてコードを分析
- Anti-MVP ポリシー、型安全性、ドキュメント規約などの観点から指摘
- 具体的な改善案を提示

### シナリオ 4: テストを追加したい

**プロンプト例:**
```
[ファイル名] のテストを追加してください。
[テストしたい内容]
```

### シナリオ 5: 品質ゲートでエラーが出た

品質ゲートは AI が自動実行しますが、手動で確認したい場合:

**プロンプト例:**
```
最後の品質ゲートの結果を詳しく教えてください。
```

または
```
[エラーメッセージ] というエラーが出ています。
どう修正すればいいですか？
```

---

## 品質ポリシーについて

### Anti-MVP ポリシー（重要）

このプロジェクトでは、以下を**厳格に禁止**しています:

❌ **禁止事項:**
- 沈黙フォールバック（エラーを握り潰す）
- 後方互換のための残留実装（使われていないコードの温存）
- TODO/FIXME にチケット番号がない
- 段階的移行（新旧実装の長期併存）
- 例外駆動制御（try/catch を正常系の分岐に使う）

✅ **推奨パターン:**
- 明示的なエラーハンドリング（`throw new Error()` または `Result/Either` 型）
- 型安全な列挙（`assertNever()` で網羅性を保証）
- 明示的な機能フラグ（期限・削除期日・チケット番号を明記）

AI はこれらのポリシーを常に遵守してコードを生成します。

### コメント規約

すべての `src/**/*.ts` ファイルには、以下の構造を持つ先頭ヘッダが必要です:

```typescript
/**
 * @file ファイルの目的（1行）
 * 備考: 特記事項なし（または具体的な備考）
 * - 箇条書き1（設計原則や品質要件を8-10行で記述）
 * - 箇条書き2
 * - ...（合計8-10行）
 * @see 関連ドキュメント1（最低2件必須）
 * @see 関連ドキュメント2
 * @snd 関連するSPEC-and-DESIGNへのパス（または「なし」）
 */
```

AI は自動的にこの形式でコメントを生成します。日本語で記述されます。

---

## トラブルシューティング

### 品質ゲートが失敗する場合

**プロンプト例:**
```
品質ゲートが失敗した理由を詳しく教えてください。
どう修正すればいいですか？
```

AI の動作:
1. エラーメッセージを分析
2. 該当する品質コンテキスト（`context.md`）を参照
3. 「失敗パターン」や「LLM典型NGパターン」と照合
4. 具体的な修正方法を提案し、必要に応じて自動修正

### SnD が Ready にならない場合

**プロンプト例:**
```
SnD を Ready 状態にするために、何が不足していますか？
```

AI の動作:
1. 「未確定事項」セクションをチェック
2. 不足している情報を質問
3. 必要な情報が揃えば Ready に更新

### AI が勝手に実装を始めてしまう場合

このプロジェクトでは、AI は以下の条件を**すべて満たすまで**実装を開始しません:

1. SnD が存在し、`status: Ready` である
2. `quality_refresh_hash_at_created` が記録されている
3. `quality_refresh_hash_before_impl` が記録されている
4. あなたが明示的に実装開始を承認している（`PHASE=IMPL 承認` フレーズ）

小規模な修正（テストの追加、数行の変更）の場合のみ、`MAINT=承認` の範囲で例外的に実行されます。

---

## 高度な使い方

### 新しい品質ゲートを追加する

**プロンプト例:**
```
新しいポリシー「[ポリシー名]」を追加したいです。
このポリシーは [説明] をチェックするものです。
設定ファイルとスクリプトを作成してください。
```

AI の動作:
1. SnD を作成して設計を明確化
2. `qualities/policy/[ポリシー名]/` に設定ファイルを作成
3. `qualities/check-steps.ts` に定義を追加
4. 品質コンテキストを自動生成

### プロジェクト全体のリファクタリング

**プロンプト例:**
```
[リファクタリングの内容] を行いたいです。
影響範囲を分析して、SnD を作成してください。
```

AI の動作:
1. 影響範囲を静的解析
2. 包括的な SnD を作成（依存関係、移行計画、ロールバック手順を含む）
3. あなたの承認を得てから段階的に実装

### 品質基準のカスタマイズ

**プロンプト例:**
```
[特定のルール] を緩和/厳格化したいです。
理由は [説明] です。
```

AI の動作:
1. 影響範囲を分析
2. SnD を作成して変更の妥当性を検証
3. `qualities/` 配下の設定を更新
4. 品質コンテキストを再生成

---

## プロンプトのベストプラクティス

### ✅ 良いプロンプト

- **具体的**: 「○○機能を追加」「○○ファイルの○○関数を修正」
- **理由を含む**: 「○○のため、○○が必要です」
- **段階的**: 大きなタスクは「まず設計」→「実装」と分ける

例:
```
ユーザー認証機能を追加したいです。
JWT トークンを使った認証で、ログイン・ログアウト・トークン検証が必要です。
まず SnD を作成してください。
```

### ❌ 避けるべきプロンプト

- **曖昧**: 「何か改善して」「もっと良くして」
- **複数の要求を一度に**: 「A と B と C を全部やって」（段階的に依頼する）
- **品質基準を無視**: 「とりあえず動けばいいので」（品質ゲートは必須）

---

## AI との協働のコツ

1. **設計を急がない**: AI は SnD の作成を重視します。不明点があれば質問してください。
2. **品質ゲートを信頼する**: AI は自動的に品質チェックを行います。エラーは学習の機会です。
3. **段階的に進める**: 大きな機能は小さな SnD に分割して開発します。
4. **フィードバックを与える**: 生成されたコードに不満があれば、具体的に指摘してください。

---

## ライセンス

MIT License

Copyright (c) 2025 cozyupk

詳細は [LICENSE](LICENSE) を参照してください。

---

## さらに詳しく知りたい場合

- [vibecoding/docs/PLAYBOOK/](vibecoding/docs/PLAYBOOK/) - AI が参照するプレイブック
- [qualities/](qualities/) - 品質ゲート設定の詳細
- [qualities/policy/anti_mvp/anti_mvp_policy.md](qualities/policy/anti_mvp/anti_mvp_policy.md) - Anti-MVP ポリシーの全文

---

## プロンプトクイックリファレンス

| やりたいこと | プロンプト例 |
|------------|------------|
| 新機能開発 | `[機能名]を開発したいです。SnD を作成してください` |
| 実装開始 | `PHASE=IMPL 承認: SnD=[パス]` または `[機能名]の実装を開始してください` |
| バグ修正 | `[ファイル名]の[内容]を修正してください` |
| テスト追加 | `[ファイル名]のテストを追加してください` |
| コードレビュー | `[ファイル名]をレビューしてください` |
| 品質ゲート実行 | `品質ゲートを実行してください` |
| 品質コンテキスト更新 | `品質コンテキストを更新してください` |
| エラー解決 | `[エラー]を修正してください` |
| リファクタリング | `[内容]をリファクタリングしたいです。SnD を作成してください` |

---

**Happy Coding with AI! 🚀**
